@{
    Layout = "_DetailsLayout";
}

@using Microsoft.Extensions.Options
@using Tolab.Common
@model TolabPortal.DataAccess.Models.Course
@inject IOptions<ApplicationConfig> options;

@{
    ViewBag.itemDetails = Model.ItemDetails;
    var config = options.Value;

}

<!--======================================
        START COURSE DETAILS AREA
======================================-->
<section class="course-details-area pb-20px bg-grligh">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 pb-5">
                <div class="course-details-content-wrap pt-50px">
                    <div class="course-overview-card">
                        <h3 class="fs-23 txtbold pb-3">تفاصيل الدورة</h3>
                        <p class="fs-15 pb-2"> @Model.FullDescription </p>
                    </div><!-- end course-overview-card -->
                    <div class="course-overview-card">
                        <div class="curriculum-header d-flex align-items-center justify-content-between pb-4">
                            <h3 class="fs-23 txtbold">المحاضرات</h3>
                        </div>
                        <div class="curriculum-content">
                            <div id="accordion" class="generic-accordion">

                                <!-- ============= Course Content ============= -->
                                @{
                                    int iterator = 1;
                                }
                                @foreach (var group in Model.Groups)
                                {

                                    var accordionButtonId = "heading_" + group.Id.ToString();
                                    var accordionCollapseKey = "collapse_" + group.Id.ToString() + (iterator++).ToString();

                                    <div class="card">
                                        <div class="card-header" id="@accordionButtonId">
                                            <button class="btn btn-link d-flex align-items-center justify-content-between" data-toggle="collapse" data-target="#@accordionCollapseKey" aria-expanded="true" aria-controls="@accordionCollapseKey">
                                                <i class="la la-plus"></i>
                                                <i class="la la-minus"></i>
                                                @group.NameLT
                                                <span class="fs-15 text-gray font-weight-medium text-color-9">(@group.Contents.Count) جزء</span>
                                            </button>
                                        </div><!-- end card-header -->
                                        <div id="@accordionCollapseKey" class="collapse show" aria-labelledby="@accordionButtonId" data-parent="#accordion">
                                            <div class="card-body">
                                                <ul class="generic-list-item">
                                                    @foreach (var groupContent in group.Contents)
                                                    {
                                                        if (groupContent.ContentTypeId == 1) // video
                                                        {

                                                            <li>
                                                                @if (Model.IsCurrentStudentSubscribedToCourse)
                                                                {
                                                                    <a href="@options.Value.MediaBaseUrl/ws/CourseVideos/@groupContent.VideoUri" class="d-flex align-items-center justify-content-between text-color">
                                                                        <span>
                                                                            <i class="la la-play-circle mr-1"></i>
                                                                            @groupContent.NameLT
                                                                        </span>
                                                                        <span> @groupContent.Duration دقيقة </span>
                                                                    </a>
                                                                }
                                                                else
                                                                {
                                                                    <a class="d-flex align-items-center justify-content-between">
                                                                        <span>
                                                                            <i class="la la-lock mr-1"></i>
                                                                            @groupContent.NameLT
                                                                        </span>
                                                                        <span>@groupContent.Duration دقيقة</span>
                                                                    </a>
                                                                }
                                                            </li>

                                                        }
                                                        else if (groupContent.ContentTypeId == 2)
                                                        {
                                                            var url = Model.IsCurrentStudentSubscribedToCourse ? groupContent.Path : "#";

                                                            <li>
                                                                @if (Model.IsCurrentStudentSubscribedToCourse)
                                                                {
                                                                    //TODO: @hussein fix files path
                                                                    <a href="@options.Value.MediaBaseUrl/ws/CourseVideos/@groupContent.Path" class="d-flex align-items-center justify-content-between text-color">
                                                                        <span>
                                                                            <i class="la la-file-pdf-o mr-1"></i>
                                                                            @groupContent.NameLT
                                                                        </span>
                                                                        <span> </span>
                                                                    </a>
                                                                }
                                                                else
                                                                {
                                                                    <a class="d-flex align-items-center justify-content-between">
                                                                        <span>
                                                                            <i class="la la-lock mr-1"></i>
                                                                            @groupContent.NameLT
                                                                        </span>
                                                                    </a>
                                                                }
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                            </div><!-- end card-body -->
                                        </div><!-- end collapse -->
                                    </div><!-- end card -->
                                }

                                <!-- ============= Course Exams ============= -->
                                <!--<div class="card">
                                    <div class="card-header" id="headingThree">
                                        <button class="btn btn-link collapsed d-flex align-items-center justify-content-between" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                            <i class="la la-plus"></i>
                                            <i class="la la-minus"></i>
                                            الإمتحانات والواجبات
                                            <span class="fs-15 text-gray font-weight-medium text-color-9">0 واجبات</span>
                                        </button>
                                    </div>
                                    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                                        <div class="card-body">
                                            <ul class="generic-list-item">

                                                // loop on exams here...
                                            </ul>
                                        </div>-->
                                <!-- end card-body -->
                                <!--</div>--><!-- end collapse -->
                                <!--</div>--><!-- end card -->
                            </div><!-- end generic-accordion -->
                        </div><!-- end curriculum-content -->
                    </div><!-- end course-overview-card -->
                    <!-- ============= Course Questions ============= -->
                    <div class="course-overview-card pt-4">
                        <h3 class="fs-23 txtbold pb-4">الأسئلة</h3>
                        <div class="review-wrap">
                            @foreach (var videoQuestion in Model.VideoQuestions.ToList())
                            {
                                <div class="media media-card border-bottom border-bottom-gray pb-4 mb-4">
                                    <div class="media-img mr-4 rounded-full borderonew">
                                        <img class="rounded-full lazy" src="/images/img-loading-ar.png" data-src="@config.MediaBaseUrl/ws/Images/StudentImages/@videoQuestion.StudentPhoto">
                                    </div>
                                    <div class="media-body">
                                        <div class="d-flex flex-wrap align-items-center justify-content-between pb-1">
                                            <h5> @videoQuestion.StudentName </h5>
                                        </div>
                                        <span class="d-block lh-18 pb-2"> @videoQuestion.CreationDate </span>
                                        <p class="pb-2">
                                            @videoQuestion.Question
                                        </p>
                                    </div>
                                </div><!-- end media -->
                            }
                        </div><!-- end review-wrap -->
                        @*<div class="see-more-review-btn text-center">
                                <button type="button" class="btn theme-btn theme-btn-transparent">عرض مزيد من الاسئلة</button>
                            </div>*@
                    </div><!-- end course-overview-card -->
                </div><!-- end course-details-content-wrap -->
            </div><!-- end col-lg-8 -->
            <div class="col-lg-4">
                <div class="sidebar sidebar-negative">
                    <div class="card card-item">
                        <div class="card-body">
                            <div class="preview-course-video">
                                <a href="@config.MediaBaseUrl/ws/CourseVideos/@Model.IntroVideoUri" data-toggle="modal" data-target="#previewModal">
                                    <img src="images/img-loading.png" data-src="@config.MediaBaseUrl/ws/Images/CourseImages/@Model.Image" class="w-100 rounded lazy screensh">
                                    <div class="preview-course-video-content">
                                        <div class="overlay"></div>
                                        <div class="play-button">
                                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="-307.4 338.8 91.8 91.8" style=" enable-background:new -307.4 338.8 91.8 91.8;" xml:space="preserve">
                                            <style type="text/css">
                                                .st0 {
                                                    fill: #ffffff;
                                                    border-radius: 100px;
                                                }

                                                .st1 {
                                                    fill: #000000;
                                                }
</style>
                                            <g>
                                            <circle class="st0" cx="-261.5" cy="384.7" r="45.9"></circle><path class="st1" d="M-272.9,363.2l35.8,20.7c0.7,0.4,0.7,1.3,0,1.7l-35.8,20.7c-0.7,0.4-1.5-0.1-1.5-0.9V364C-274.4,363.3-273.5,362.8-272.9,363.2z"></path>
                                             </g>
                                         </svg>
                                        </div>
                                        <p class="fs-15 font-weight-bold text-white pt-3">معاينة هذه الدورة</p>
                                    </div>
                                </a>
                            </div><!-- end preview-course-video -->
                            <div class="preview-course-feature-content pt-30px">
                                <p class="d-flex align-items-center pb-40px">
                                    <span class="fs-35 font-weight-semi-bold text-black"> @Model.CurrentCost </span>
                                    <span class="before-price mx-1">@Model.PreviousCost </span>
                                </p>

                                @if (Model.IsCurrentStudentSubscribedToCourse)
                                {
                                    <div class="buy-course-btn-box pb-4">
                                        <div class="regdone">
                                            <img src="/images/check.svg" width="28"> تم الاشتراك
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    @await Component.InvokeAsync("MyFatoorahPayment",
                                    new PayVm
                                        {
                                           InvoiceAmount = Model.CurrentCost.Value,
                                           TransactionId = Model.Id.ToString(),
                                           TransactionType = (int)TransactionType.Course,
                                           ReturnRoute = $"/Subjects/Track/Course?courseId={Model.Id}&trackNameLT={Model.ItemDetails.TrackName}",
                                             CssClassName = "btn-block"
                                        })
                                }

                                <div class="preview-course-incentives">
                                    <h3 class="card-title fs-18 pb-2">تشمل هذه الدورة</h3>
                                    <ul class="generic-list-item">
                                        @{
                                            var courseVideCount = (Model.VideoCount == 0) ? Model.Groups.Sum(g => g.Contents.Count(c => c.ContentTypeId == 1)) : Model.VideoCount;
                                            var courseFilesCount = (Model.FilesCount == 0) ? Model.Groups.Sum(g => g.Contents.Count(c => c.ContentTypeId == 2)) : Model.FilesCount;
                                            var courseDuration = Model.Groups.Sum(g => g.Contents.Where(c => c.ContentTypeId == 1).Sum(c => c.Duration));
                                            //var courseExamsCount = Model.StudentExams.ToList().Count;
                                        }
                                        <li><i class="la la-play-circle-o mr-2 text-color"></i> @courseVideCount فيديوهات</li>
                                        <li><i class="la la-clock mr-2 text-color"></i>@courseDuration دقيقة تشغيل</li>
                                        <li><i class="la la-file mr-2 text-color"></i>@courseFilesCount ملفات مذكرات</li>
                                        @*<li><i class="la la-file-text mr-2 text-color"></i>@courseExamsCount  امتحانات وواجبات</li>*@
                                    </ul>
                                </div><!-- end preview-course-incentives -->
                            </div><!-- end preview-course-content -->
                        </div>
                    </div><!-- end card -->
                </div><!-- end sidebar -->
            </div><!-- end col-lg-4 -->
        </div><!-- end row -->
    </div><!-- end container -->
</section><!-- end course-details-area -->
<!--======================================
        END COURSE DETAILS AREA
======================================-->